

<div id="login-page">
  <div @click="loginWithGoogle()">Login By Google</div>
</div>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script>
  var vm = new Vue({
    el: '#login-page',
    data: {
      
    },
    methods: {
      loginWithGoogle: function() {
        var self = this
        var provider = new firebase.auth.GoogleAuthProvider()

        firebase.auth().signInWithPopup(provider).then(function(result) {
          // This gives you a Google Access Token. You can use it to access the Google API.
          var token = result.credential.accessToken
          // The signed-in user info.
          var user = result.user

          self.checkUserSigned()
          // ...
        }).catch(function(error) {
          // Handle Errors here.
          var errorCode = error.code
          
          var errorMessage = error.message
          // The email of the user's account used.
          var email = error.email
          // The firebase.auth.AuthCredential type that was used.
          var credential = error.credential
          // ...
        })
      },
      checkUserSigned: function() {
        firebase.auth().onAuthStateChanged(function(user) {
          if (user) {
            // console.log(user)
            console.log('User signed')
            user.getIdToken().then(function(idToken) {  // <------ Check this line
              axios.post('/login', {
                token: idToken
              }, {
                headers: {
                  'X-CSRF-Token': document.querySelector('[name=csrf-token]').content,
                  'Content-Type': 'application/json'
                }
              }).then(res => {
                if (res.status === 200) {
                  window.location = '/'
                }
              })
            })
          } else {
            console.log('No User signed')
          }
        })
      }
    },
    mounted: function() {
      // this.checkUserSigned()
    }
  })
</script>

